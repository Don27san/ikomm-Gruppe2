<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Live Location</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html,
    body,
    #map {
      height: 100%;
      margin: 0;
    }
    .custom-marker {
      width: 20px;
      height: 20px;
      background-color: #007bff;
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 0 4px rgba(0, 0, 255, 0.5);
      position: relative;
      z-index: 2;
    }
    .pulse-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      animation: pulse 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
      background-color: #007bff;
      z-index: -1;
    }

    @keyframes pulse {
      0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 1;
      }
      80% {
        transform: translate(-50%, -50%) scale(4);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(4);
        opacity: 0;
      }
    }
  </style>
  <script>
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const initialLat = parseFloat(urlParams.get('lat')) || 0;
    const initialLon = parseFloat(urlParams.get('lon')) || 0;
    const author = urlParams.get('author') || 'Unknown';

    const customMarker = L.divIcon({
      html: '<div class="custom-marker"><div class="pulse-ring"></div></div>',
      className: '',
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });

    let map;
    let markers = {};
    function initMap(lat = 0, lon = 0, author = 'Unknown') {
      map = L.map('map').setView([lat, lon], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'ðŸ“ Live Location Active'
      }).addTo(map);
       markers[author] = L.marker([lat, lon], { icon: customMarker }).addTo(map);
    }
    function updatePosition(lat, lon, author) {
      if (markers[author]) {
        markers[author].setLatLng([lat, lon]);
      } else {
        markers[author] = L.marker([lat, lon], { icon: customMarker }).addTo(map);
      }
      //map.setView([lat, lon], map.getZoom());
      const allLatLngs = Object.values(markers).map(marker => marker.getLatLng());
      if (allLatLngs.length > 0) {
        map.fitBounds(L.latLngBounds(allLatLngs), { padding: [50, 50] });
      }
    }
  </script>
</head>

<body onload="initMap(initialLat, initialLon, author)">
  <div id="map"></div>
</body>

</html>